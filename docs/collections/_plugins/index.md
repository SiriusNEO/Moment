---
title: 什么是插件 Plugins
nav_order: 0
---

# 什么是插件 Plugins
插件 (Plugins) 是 Moment 对于所有功能的统一抽象。事实上，许多聊天机器人也都有类似的概念。你可以类比游戏的模组等。



## 1. 设计理念

聊天机器人设计上的优雅性常常成为许多开发者面临的难题。开发者所追求的优雅，和使用者追求的方便往往的有着矛盾的。事实上，聊天机器人在实际落地时，需求往往五花八门，各种命令格式更是层出不穷，想要用一个统一优美的架构抽象起来，可以说是非常之难了。

为了兼顾统一的上层设计和底下纷繁的功能需求，有必要对每种功能做一个抽象。这样就把具体功能的实现（往往是丑的，顾全实际的）和统一的部分分离开来。

同时，这种模块化的设计还方便功能的插拔。由于功能千奇百怪，有时需要用到很多第三方库，这些库也不一定是稳定的，因此插件也往往会发生局部失效的情况。这时可以灵活地选择关闭特定插件，保证其它部分的正常运作。也方便开发者维护。

此外，插件设计还方便用户自定义功能（只需要创建一个新插件）。这部分会在进一步开发篇章中详细谈到。



## 基本抽象

每个 Plugin 有两个主要的任务，在代码中也被设计为两个主要的方法。

- `handle_message`

  顾名思义，这一接口描述这个插件 "在接到消息时会怎么做"。其返回的也是消息（或者消息列），表示机器人的回应。

- `plugin_task`

  这部分是每个 Plugin 各自的 "后台任务"，可以理解为类似守护进程的存在。例如闹钟插件，需要在指定时间报时，这就需要通过 `plugin_task` 完成。

  `plugin_task` 的主体往往是一个 `while True` 循环，来保证后台长期运行（当然，除非你就执行一次）。它们会在启动机器人时统一被注册为一个异步的任务。

{: .attention }
并不是每个插件都有这两个方法，这完全取决于插件的功能。

不同于许多常见机器人（以事件为响应对象），Moment 直接以消息（Message）为响应对象。这是因为在跨平台下，不同聊天软件的事件实际是很不同的（比如某些聊天软件的 "戳一戳"，在另外一些聊天平台根本没有）。因此针对事件编写的一些行为并不具有很好的跨平台性。

再者，Moment 的功能重点也是围绕消息进行的，其它事件（如退群踢人什么的）对它意义不大。因此设计上选择了大刀阔斧直接砍掉乱七八糟的各种事件，变成简单的 收到消息-回复消息 模式。



## 2. 插件管理

Help 插件本身具有插件管理的作用。前面提到 `help` 就可以查看各个插件的运行情况，主要有 `running` 和 `banned`。

禁用、解禁插件是一个权限级别的命令，你可以通过查看 Help 这个插件的帮助文档来查看相关命令用法。

此外，你还可以在代码层面上对机器人启动时安装哪些插件进行修改。